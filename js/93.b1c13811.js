"use strict";(self["webpackChunktorch_graph"]=self["webpackChunktorch_graph"]||[]).push([[93],{86093:(e,t,n)=>{n.r(t),n.d(t,{default:()=>le});var o=n(83673);(0,o.dD)("data-v-4f384c6c");const i={style:{height:"calc(100vh - 50px)"}},d={ref:"monaco_editor_container",style:{height:"calc(100vh - 100px)"}},l=(0,o.Uk)("123"),a={id:"graph"},c=(0,o._)("defs",null,[(0,o._)("marker",{id:"markerCircle",markerWidth:"8",markerHeight:"8",refX:"5",refY:"5"},[(0,o._)("circle",{cx:"5",cy:"5",r:"3",style:{stroke:"none",fill:"#000000"}})]),(0,o._)("marker",{id:"markerArrow",markerWidth:"13",markerHeight:"13",refX:"9",refY:"6",orient:"auto"},[(0,o._)("path",{d:"M2,2 L2,11 L10,6 L2,2",style:{fill:"#000000"}})])],-1),s={id:"canvas"},u=(0,o._)("div",null,[(0,o._)("div",{class:"text-weight-bold"},"點選要連接的Node")],-1),r=(0,o._)("span",{class:"q-ml-sm"},"The node connected edges.",-1),h=(0,o._)("span",{class:"q-ml-sm"},"The edges will be removed.",-1);function g(e,t,n,g,m,p){const f=(0,o.up)("q-btn"),w=(0,o.up)("node"),v=(0,o.up)("edge"),C=(0,o.up)("context-menu"),_=(0,o.up)("q-card-section"),y=(0,o.up)("q-card"),k=(0,o.up)("q-dialog"),x=(0,o.up)("q-card-actions"),b=(0,o.up)("q-splitter"),N=(0,o.up)("q-page"),S=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(N,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,{modelValue:e.splitterModel,"onUpdate:modelValue":t[5]||(t[5]=t=>e.splitterModel=t),style:{"min-height":"inherit"}},{before:(0,o.w5)((()=>[(0,o._)("div",i,[(0,o._)("div",d,null,512),(0,o.Wm)(f,{onClick:e.editor_getValue},{default:(0,o.w5)((()=>[l])),_:1},8,["onClick"])])])),after:(0,o.w5)((()=>[(0,o._)("div",a,[((0,o.wg)(),(0,o.iD)("svg",null,[c,(0,o._)("g",s,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.nodes,(t=>((0,o.wg)(),(0,o.j4)(w,{key:t.id,node:t,margin:{top:0,right:0,bottom:0,left:0},onUpdateSize:e.graphOperations.updateNodeSize,onUpdateContent:e.graphOperations.updateNodeContent,onSelected:e.graphOperations.nodeSelected,onCollapseNode:e.graphOperations.collapseNode},null,8,["node","onUpdateSize","onUpdateContent","onSelected","onCollapseNode"])))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.edges,(t=>((0,o.wg)(),(0,o.j4)(v,{key:t.id,edge:t,margin:{top:0,right:0,bottom:0,left:0},onSelected:e.graphOperations.edgeSelected},null,8,["edge","onSelected"])))),128))]),(0,o.Wm)(C,{showContextmenu:e.showContextmenu,"onUpdate:showContextmenu":t[0]||(t[0]=t=>e.showContextmenu=t),contextmenuTransform:e.contextmenuTransform,onAction:e.contextmenuActions,contextmenuType:e.contextmenuType},null,8,["showContextmenu","contextmenuTransform","onAction","contextmenuType"])]))]),(0,o.Wm)(k,{modelValue:e.qDialog_seamless,"onUpdate:modelValue":t[2]||(t[2]=t=>e.qDialog_seamless=t),seamless:"",position:"bottom"},{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{class:"row items-center no-wrap"},{default:(0,o.w5)((()=>[u,(0,o.wy)((0,o.Wm)(f,{flat:"",round:"",icon:"close",onClick:t[1]||(t[1]=t=>e.status="")},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(k,{modelValue:e.qDialog_confirm,"onUpdate:modelValue":t[4]||(t[4]=t=>e.qDialog_confirm=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{class:"row items-center"},{default:(0,o.w5)((()=>[r,h])),_:1}),(0,o.Wm)(x,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[S]]),(0,o.wy)((0,o.Wm)(f,{flat:"",label:"Delete",color:"primary",onClick:t[3]||(t[3]=t=>e.contextmenuActions("deleteNodeAndEdges"))},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})}(0,o.Cn)();var m=n(61959),p=(n(10071),n(98880)),f=n(62323);(0,o.dD)("data-v-20d63545");const w=["id","transform"],v=["width","height"],C=["width","height"],_={ref:"nodeContent",class:"nodeContent"},y=["contenteditable"];function k(e,t,n,i,d,l){const a=(0,o.up)("q-btn"),c=(0,o.up)("node",!0),s=(0,o.up)("edge"),u=(0,o.Q2)("focus");return(0,o.wg)(),(0,o.iD)("g",{ref:"nodeRef",class:"node",id:e.node.id,transform:e.nodeTransform},[(0,o._)("rect",{class:"nodeBackground",width:e.node.width,height:e.node.height},null,8,v),((0,o.wg)(),(0,o.iD)("foreignObject",{width:e.nodeSize.width,height:e.nodeSize.height},[(0,o._)("div",_,[(0,o.wy)((0,o._)("div",{contenteditable:e.edit,onKeyup:[t[0]||(t[0]=(...t)=>e.updateSize&&e.updateSize(...t)),t[4]||(t[4]=(0,p.D2)(((...t)=>e.updateContent&&e.updateContent(...t)),["enter"]))],onClick:t[1]||(t[1]=(...t)=>e.clicked&&e.clicked(...t)),onDblclick:t[2]||(t[2]=t=>e.edit=!0),onBlur:t[3]||(t[3]=(...t)=>e.updateContent&&e.updateContent(...t)),onContextmenu:t[5]||(t[5]=t=>e.$emit("selected",e.node.id))},[(0,o.Uk)((0,f.zw)(e.content),1)],40,y),[[u]]),"+"==e.collapse_status||"-"==e.collapse_status?((0,o.wg)(),(0,o.j4)(a,{key:0,color:"primary",size:"xs",round:"",label:e.collapse_status,onClick:e.collapseNode},null,8,["label","onClick"])):(0,o.kq)("",!0)],512)],8,C)),(0,o._)("g",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sub_nodes,(t=>((0,o.wg)(),(0,o.j4)(c,{key:t.id,node:t,margin:{top:e.nodeSize.height,right:0,bottom:0,left:0},onUpdateSize:e.updateSubSize,onUpdateContent:e.updateSubContent,onSelected:e.subClicked,onCollapseNode:e.collapseSubNode},null,8,["node","margin","onUpdateSize","onUpdateContent","onSelected","onCollapseNode"])))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sub_edges,(t=>((0,o.wg)(),(0,o.j4)(s,{key:t.id,edge:t,margin:{top:e.nodeSize.height,right:0,bottom:0,left:0}},null,8,["edge","margin"])))),128))])],8,w)}(0,o.Cn)();const x=["id","d"];function b(e,t,n,i,d,l){return(0,o.wg)(),(0,o.iD)("path",{ref:"nodePath",id:e.edge.id,d:e.pathData,fill:"none",stroke:"black",style:{stroke:"#6666ff","stroke-width":"1px",fill:"none","marker-start":"url(#markerCircle)","marker-end":"url(#markerArrow)"},onContextmenu:t[0]||(t[0]=t=>e.$emit("selected",e.edge.id))},null,40,x)}const N=(0,o.aZ)({name:"Edge",props:{edge:{type:Object,required:!0},margin:{type:Object,required:!0}},computed:{pathData(){if(void 0===this.edge.sections)return"";{const e=this.edge.sections[0].startPoint,t=`M${e.x},${e.y+this.margin.top}`;let n="";if(this.edge.sections[0].bendPoints){const e=this.edge.sections[0].bendPoints;e.forEach((e=>{n+=` L${e.x},${e.y+this.margin.top}`}))}const o=this.edge.sections[0].endPoint,i=` L${o.x},${o.y+this.margin.top}`;return t+n+i}}}});N.render=b;const S=N,D=(0,o.aZ)({name:"Node",components:{Edge:S},props:{node:{type:Object,required:!0},margin:{type:Object,required:!0}},computed:{nodeTransform(){return"x"in this.node?`translate(${this.node.x},${this.node.y+this.margin.top})`:"translate(0,0)"},sub_nodes(){return"children"in this.node?this.node.children:[]},sub_edges(){return"edges"in this.node?this.node.edges:[]}},emits:["updateSize","updateContent","selected","collapseNode"],setup(e,t){const n=(0,m.iH)();let i=(0,m.iH)(e.node.content);const d=(0,m.iH)({width:1,height:1});let l=(0,m.iH)(!1);const a=()=>{d.value={width:n.value.offsetWidth,height:n.value.offsetHeight},t.emit("updateSize",e.node.id,d.value)},c=()=>{l.value=!1,t.emit("updateContent",e.node.id,i.value)},s=(0,m.Fl)((()=>"children"in e.node?"-":"_children"in e.node?"+":"unable"));function u(){console.log("collapseNode");let n=null;"-"==s.value&&(n="collapse"),"+"==s.value&&(n="expand"),t.emit("collapseNode",e.node.id,n)}function r(e,n){t.emit("updateSize",e,n)}function h(e,n){t.emit("updateContent",e,n)}function g(e,n){t.emit("collapseNode",e,n)}(0,o.bv)((()=>{a()})),(0,o.ic)((()=>{}));const p=()=>{t.emit("selected",e.node.id)};function f(e){t.emit("selected",e)}return{nodeContent:n,content:i,nodeSize:d,edit:l,updateSize:a,updateContent:c,collapse_status:s,collapseNode:u,updateSubSize:r,updateSubContent:h,collapseSubNode:g,clicked:p,subClicked:f}},directives:{focus:{updated(e){e.focus()}}}});var q=n(29400),E=n(7518),H=n.n(E);D.render=k,D.__scopeId="data-v-20d63545";const T=D;H()(D,"components",{QBtn:q.Z}),(0,o.dD)("data-v-38661480");const j=["transform"],O=(0,o.Uk)("Add node"),W=(0,o.Uk)("Connect"),z=(0,o.Uk)("Delete node"),U=(0,o.Uk)("Delete edge");function A(e,t,n,i,d,l){const a=(0,o.up)("q-item-section"),c=(0,o.up)("q-item"),s=(0,o.up)("q-list"),u=(0,o.Q2)("ripple"),r=(0,o.Q2)("click-outside");return e.showContextmenu?(0,o.wy)(((0,o.wg)(),(0,o.iD)("foreignObject",{key:0,width:"1",height:"1",transform:`translate(${e.contextmenuTransform.x},${e.contextmenuTransform.y})`},[(0,o.Wm)(s,{bordered:"",separator:"",class:"contextMenu"},{default:(0,o.w5)((()=>["background"==e.contextmenuType?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:0,clickable:"",onClick:t[0]||(t[0]=t=>(e.$emit("action","addNode"),e.hideContextmenu()))},{default:(0,o.w5)((()=>[(0,o.Wm)(a,null,{default:(0,o.w5)((()=>[O])),_:1})])),_:1},512)),[[u]]):(0,o.kq)("",!0),"node"==e.contextmenuType?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:1,clickable:"",onClick:t[1]||(t[1]=t=>(e.$emit("action","connect"),e.hideContextmenu()))},{default:(0,o.w5)((()=>[(0,o.Wm)(a,null,{default:(0,o.w5)((()=>[W])),_:1})])),_:1},512)),[[u]]):(0,o.kq)("",!0),"node"==e.contextmenuType?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:2,clickable:"",onClick:t[2]||(t[2]=t=>(e.$emit("action","deleteNode"),e.hideContextmenu()))},{default:(0,o.w5)((()=>[(0,o.Wm)(a,null,{default:(0,o.w5)((()=>[z])),_:1})])),_:1},512)),[[u]]):(0,o.kq)("",!0),"edge"==e.contextmenuType?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:3,clickable:"",onClick:t[3]||(t[3]=t=>(e.$emit("action","deleteEdge"),e.hideContextmenu()))},{default:(0,o.w5)((()=>[(0,o.Wm)(a,null,{default:(0,o.w5)((()=>[U])),_:1})])),_:1},512)),[[u]]):(0,o.kq)("",!0)])),_:1})],8,j)),[[r,e.hideContextmenu]]):(0,o.kq)("",!0)}(0,o.Cn)();const $=(0,o.aZ)({name:"ContextMenu",props:{showContextmenu:{type:Boolean,required:!0},contextmenuTransform:{type:Object,required:!0},contextmenuType:{type:String,required:!0}},emits:["update:showContextmenu","action"],setup(e,t){const n=()=>{t.emit("update:showContextmenu",!1)};return{hideContextmenu:n}},directives:{clickOutside:{mounted(e,t,n){e.clickOutsideEvent=function(n){e==n.target||e.contains(n.target)||t.value()},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}}});var L=n(27011),Z=n(83414),Q=n(52035),P=n(46489);$.render=A,$.__scopeId="data-v-38661480";const V=$;H()($,"components",{QList:L.Z,QItem:Z.Z,QItemSection:Q.Z}),H()($,"directives",{Ripple:P.Z});var I=n(49706);function M(){const e=(0,m.iH)({x:0,y:0,scale:1}),t=(0,m.iH)(""),n=(0,m.iH)(!1),i=(0,m.iH)("background"),d=(0,m.iH)({x:0,y:0});function l(t,n){const o=I.Ys("#canvas");o.attr("transform",t.transform),e.value.x=t.transform.x,e.value.y=t.transform.y,e.value.scale=t.transform.k}function a(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button&&!("dblclick"===e.type)&&!("true"===e.target.contentEditable)}function c(e,o){e.preventDefault(),n.value=!0;const l=I.Ys("#graph").select("svg").node(),a=I.cx$(e,l),c={x:0,y:0};c.x=a[0],c.y=a[1],d.value.x=c.x,d.value.y=c.y;const s={background:{tag:["svg"]},node:{class:["nodeContent"]},edge:{tag:["path"]}};function u(e){for(const[t,n]of Object.entries(s))for(const[o,i]of Object.entries(n))if("tag"==o){const n=e.tagName;for(let e=0;e<i.length;e++){const o=i[e];if(n===o)return t}}else if("class"===o){let n="";n="object"===typeof e.className?e.className.baseVal.split():e.className.split();for(let e=0;e<i.length;e++){const o=i[e];if(n.includes(o))return t}}else if("id"===o){const n=e.getAttribute("id");for(let e=0;e<i.length;e++){const o=i[e];if(n===o)return t}}else console.log("selector error");return u(e.parentElement)}function r(e){return e.getAttribute("id")?e.getAttribute("id"):"svg"===e.tagName?null:r(e.parentElement)}const h=I.cx$(e,document),g=document.elementFromPoint(h[0],h[1]);i.value=u(g),t.value=r(g)}return(0,o.bv)((()=>{const e=I.sPX().scaleExtent([1,10]).on("zoom",((e,t)=>l(e,t))).filter((e=>a(e)));I.Ys("#graph").select("svg").call(e),I.Ys("#graph").select("svg").on("contextmenu",((e,t)=>c(e,t)))})),{canvasTransform:e,selectedElement:t,showContextmenu:n,contextmenuType:i,contextmenuTransform:d}}var Y=n(69447),K=n.n(Y);function B(e){const t=new(K());let n=(0,m.iH)(e.value.children),i=(0,m.iH)(e.value.edges);function d(e,t=null,n=null){"sections"in e&&delete e["sections"];const o=Object.keys(e);for(let i=0,l=o.length;i<l;i++){const t=o[i];if(e[t]&&"object"==typeof e[t])d(e[t],e,t)}}async function l(e){await t.layout(e)}async function a(e){if("children"in e){for(let o=0;o<e.children.length;o++){const t=e.children[o],n=await a(t);t.width=n.width,t.height=n.height}e["layoutOptions"]={"elk.algorithm":"layered","nodePlacement.strategy":"SIMPLE","elk.direction":"DOWN",hierarchyHandling:"INCLUDE_CHILDREN"},await l(e);const t=e.nodeContent_width>e.width?e.nodeContent_width:e.width,n=e.nodeContent_height+e.height;return{width:t,height:n}}return e.width=e.nodeContent_width,e.height=e.nodeContent_height,{width:e.width,height:e.height}}async function c(){d(e.value),await a(e.value),n.value=e.value.children,i.value=e.value.edges}return(0,o.bv)((()=>{setTimeout((()=>c()),200)})),{applyLayout:c,nodes:n,edges:i}}function R(e,t,n,o,i,d){const l=(0,m.iH)("");function a(e){n.value=e,"connect node"===o.value&&(w(l.value,n.value),n.value="",i.value=!1,o.value="normal"),console.log(n.value)}function c(e){n.value=e,console.log(n.value)}function s(n,o){let i=_(e.value,"id",n);i[0].nodeContent_width=o.width,i[0].nodeContent_height=o.height,t()}function u(t,n){let o=_(e.value,"id",t);o[0].content=n}function r(){const n={id:"na",width:0,height:0,content:"NA"};e.value.children.push(n),t()}function h(){console.log("deleteNode");const o=n.value;if(console.log(o),console.log(v(e.value,o)),v(e.value,o))d.value=!0;else{let n=_(e.value,"id",o);n[2].splice(n[3],1),t()}console.log(e.value)}function g(){const o=n.value;console.log(o);let i=_(e.value,"id",o);i[2].splice(i[3],1),C(o),t(),d.value=!1}function p(){const o=n.value;let i=_(e.value,"id",o);i[2].splice(i[3],1),t()}function f(n,o){let i=_(e.value,"id",n);"collapse"==o&&(y(i[0],"children","_children"),y(i[0],"edges","_edges")),"expand"==o&&(y(i[0],"_children","children"),y(i[0],"_edges","edges")),setTimeout((()=>t()),200)}function w(n,o){const i={id:"ea",sources:[n],targets:[o]};e.value.edges.push(i),t()}function v(e,t,n=null,o=null){const i=Object.keys(e);for(let l=0,a=i.length;l<a;l++){const n=i[l];if("edges"==n){const o=e[n];for(let e=0,n=o.length;e<n;e++)if(o[e].sources.includes(t)||o[e].targets.includes(t))return[o[e],o,e]}if(e[n]&&"object"==typeof e[n]){var d=v(e[n],t,e,n);if(d)return d}}}function C(t){while(v(e.value,t)){let n=v(e.value,t);n[1].splice(n[2],1)}}function _(e,t,n,o=null,i=null){if(e[t]===n)return[e,t,o,i];{const o=Object.keys(e);for(let i=0,l=o.length;i<l;i++){const l=o[i];if(e[l]&&"object"==typeof e[l]){var d=_(e[l],t,n,e,l);if(d)return d}}}}function y(e,t,n){delete Object.assign(e,{[n]:e[t]})[t]}return{selectedElement:n,connectSource:l,nodeSelected:a,edgeSelected:c,updateNodeSize:s,updateNodeContent:u,addNode:r,deleteNode:h,deleteNodeAndEdges:g,deleteEdge:p,collapseNode:f}}function X(e,t,n){function o(){t.value=!0,n.connectSource.value=n.selectedElement.value,e.value="connect node"}const i={addNode:n.addNode,deleteNode:n.deleteNode,deleteNodeAndEdges:n.deleteNodeAndEdges,deleteEdge:n.deleteEdge,connect:o};function d(e){i[e]()}return{contextmenuActions:d}}var F=n(37278);const G=(0,o.aZ)({name:"Graph",components:{Node:T,Edge:S,ContextMenu:V},setup(){const e=(0,m.iH)(null);let t=null;function n(){console.log(t.getValue())}(0,o.bv)((()=>{t=F.editor.create(e.value,{value:"WIP: code edit mod",language:"python",automaticLayout:!0,theme:"vs-dark"})}));const i=(0,m.iH)("normal"),d=(0,m.iH)(!1),l=(0,m.iH)(!1),a=(0,m.iH)({});a.value={id:"root",layoutOptions:{"elk.algorithm":"layered","nodePlacement.strategy":"SIMPLE","elk.direction":"DOWN",hierarchyHandling:"INCLUDE_CHILDREN"},children:[{id:"n1",width:0,height:0,content:"N1",nodeContent_width:0,nodeContent_height:0},{id:"n2",width:0,height:0,content:"N2",nodeContent_width:0,nodeContent_height:0},{id:"n3",width:0,height:0,content:"N3",nodeContent_width:0,nodeContent_height:0,children:[{id:"n31",width:0,height:0,content:"N3 1",nodeContent_width:0,nodeContent_height:0,children:[{id:"n311",width:0,height:0,content:"N3 1 1",nodeContent_width:0,nodeContent_height:0},{id:"n312",width:0,height:0,content:"N3 1 2",nodeContent_width:0,nodeContent_height:0},{id:"n313",width:0,height:0,content:"N3 1 3",nodeContent_width:0,nodeContent_height:0}],edges:[{id:"e311",sources:["n311"],targets:["n312"]},{id:"e312",sources:["n311"],targets:["n313"]}]},{id:"n32",width:0,height:0,content:"N3 2",nodeContent_width:0,nodeContent_height:0},{id:"n33",width:0,height:0,content:"N3 3",nodeContent_width:0,nodeContent_height:0}],edges:[{id:"e31",sources:["n31"],targets:["n32"]},{id:"e32",sources:["n31"],targets:["n33"]}]}],edges:[{id:"e1",sources:["n1"],targets:["n2"]},{id:"e2",sources:["n1"],targets:["n3"]}]};const{canvasTransform:c,selectedElement:s,showContextmenu:u,contextmenuType:r,contextmenuTransform:h}=M(),{applyLayout:g,nodes:p,edges:f}=B(a),w=R(a,g,s,i,d,l),{contextmenuActions:v}=X(i,d,w);return{splitterModel:(0,m.iH)(50),monaco_editor_container:e,editor_getValue:n,graphOperations:w,contextmenuActions:v,canvasTransform:c,showContextmenu:u,contextmenuTransform:h,nodes:p,edges:f,contextmenuType:r,qDialog_seamless:d,qDialog_confirm:l,status:i}}});var J=n(24379),ee=n(80218),te=n(47260),ne=n(10151),oe=n(25589),ie=n(99367),de=n(60677);G.render=g,G.__scopeId="data-v-4f384c6c";const le=G;H()(G,"components",{QPage:J.Z,QSplitter:ee.Z,QBtn:q.Z,QDialog:te.Z,QCard:ne.Z,QCardSection:oe.Z,QCardActions:ie.Z}),H()(G,"directives",{ClosePopup:de.Z})}}]);